services:
  pelagius:
    # Build from the local Dockerfile
    build: .
    image: pelagius:latest
    container_name: pelagius
    # Run the container as a specific host user to avoid bind-mount permission issues
    user: "${PUID:-1000}:${PGID:-1000}"
    restart: unless-stopped
    env_file:
      - .env
    environment:
      # Set any runtime env here or via an .env file
      - NODE_ENV=production
      - DISCORD_TOKEN=${DISCORD_TOKEN}
      - GUILD_ID=${GUILD_ID}
      - CLIENT_ID=${CLIENT_ID}
      - LOG_CHANNEL_ID=${LOG_CHANNEL_ID}
    # Persist app data (e.g., tokens.json, config.json) inside /home/node/app/data
    # APP_DATA_DIR can be overridden via environment (defaults to ./data)
    volumes:
      - ${APP_DATA_DIR:-./data}:/home/node/app/data
      # Optionally override config.json from the host (uncomment to use):
      # - ${APP_CONFIG_FILE:-./config.json}:/home/node/app/config.json:ro
    # No ports are exposed; Discord bots connect outbound only
    # command: ["yarn", "start"] # Uses Dockerfile CMD by default
